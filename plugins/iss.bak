export default function initISS(map) {
  const sourceId = 'iss-position';
  const trackSourceId = 'iss-track';
  const futureSourceId = 'iss-future-track';
  const iconId = 'iss-icon';
  const markerLayerId = 'iss-symbol';
  const lineLayerId = 'iss-track-line';
  const futureLayerId = 'iss-future-line';

  const track = []; // history

  map.loadImage('./assets/iss.png', (error, image) => {
    if (error) {
      console.error("Failed to load ISS icon:", error);
      return;
    }

    if (!map.hasImage(iconId)) {
      map.addImage(iconId, image);
    }

    // Sources
    map.addSource(sourceId, {
      type: 'geojson',
      data: { type: 'FeatureCollection', features: [] }
    });

    map.addSource(trackSourceId, {
      type: 'geojson',
      data: { type: 'Feature', geometry: { type: 'LineString', coordinates: [] } }
    });

    map.addSource(futureSourceId, {
      type: 'geojson',
      data: { type: 'Feature', geometry: { type: 'LineString', coordinates: [] } }
    });

    // Layers
    map.addLayer({
      id: markerLayerId,
      type: 'symbol',
      source: sourceId,
      layout: {
        'icon-image': iconId,
        'icon-size': 0.15,
        'icon-allow-overlap': true
      }
    });

    map.addLayer({
      id: lineLayerId,
      type: 'line',
      source: trackSourceId,
      paint: {
        'line-color': '#00ffff',
        'line-width': 2
      }
    });

    map.addLayer({
      id: futureLayerId,
      type: 'line',
      source: futureSourceId,
      paint: {
        'line-color': '#ffaa00',
        'line-width': 2,
        'line-dasharray': [2, 2]
      }
    });

    async function updateISSPosition() {
      try {
        const res = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await res.json();
